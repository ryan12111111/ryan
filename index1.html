<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì ì‹¬ë©”ë‰´ ë£°ë ›</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827; /* gray-900 */
      --accent:#22d3ee; /* cyan-400 */
      --text:#e5e7eb; /* gray-200 */
      --muted:#94a3b8; /* slate-400 */
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100svh; display:grid; place-items:center; background:radial-gradient(1200px 800px at 70% -20%, #1e293b 0%, #0b1224 60%, var(--bg) 100%); color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif;
    }
    .app{width:min(1100px, 92vw); display:grid; grid-template-columns: 1fr 1fr; gap:28px; align-items:center}
    @media (max-width: 900px){ .app{ grid-template-columns: 1fr; padding:18px 0 40px } }

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0)); border:1px solid rgba(255,255,255,0.08); border-radius:24px; padding:22px; box-shadow: 0 10px 30px rgba(0,0,0,0.3)}
    .panel h1{margin:0 0 10px; font-size:22px; font-weight:700}
    .panel p{margin:0 0 16px; color:var(--muted); font-size:14px}

    .wheel-wrap{position:relative; display:grid; place-items:center}
    .wheel{ width:min(520px, 84vw); aspect-ratio:1/1; position:relative; }
    .wheel svg{width:100%; height:100%; display:block}

    /* ì¤‘ì•™ í—ˆë¸Œ ë° í‘œì‹œ(ì¸ë””ì¼€ì´í„°) */
    .hub{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:none }
    .hub .center{ width:92px; height:92px; border-radius:999px; background:radial-gradient(circle at 30% 30%, #ffffff 0%, #a3e635 12%, #22d3ee 60%, #164e63 100%); border:2px solid rgba(255,255,255,.25); box-shadow: inset 0 0 14px rgba(0,0,0,.45), 0 8px 18px rgba(0,0,0,.45)}

    .controls{display:grid; gap:10px}
    .controls textarea{width:100%; min-height:160px; resize:vertical; border-radius:12px; padding:12px 14px; background:#0b1224; color:var(--text); border:1px solid rgba(255,255,255,0.1); font-size:14px; line-height:1.5}
    .controls .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{appearance:none; border:none; border-radius:999px; padding:12px 16px; font-weight:700; color:#0b1224; background:linear-gradient(180deg, #67e8f9, #22d3ee); cursor:pointer; transition:transform .08s ease, filter .2s ease}
    .btn.secondary{background:#0b1224; color:var(--text); border:1px solid rgba(255,255,255,0.1)}
    .btn:active{ transform:scale(.98) }
    .pill{font-size:12px; color:var(--muted)}

    .result{margin-top:8px; min-height:28px; font-weight:800; letter-spacing:.2px}
  </style>
</head>
<body>
  <div class="app">
    <div class="panel wheel-panel">
      <h1>ì ì‹¬ë©”ë‰´ ë£°ë ›</h1>
      <p>ì¤‘ì•™ ì¸ë””ì¼€ì´í„°ê°€ ëŒì•„ê°€ë©° íŒŒì´ ì¡°ê°ì„ ê°€ë¦¬ì¼œìš”.</p>
      <div class="wheel-wrap">
        <div class="wheel" id="wheel"><!-- SVG wheel & indicator injected here --></div>
        <div class="hub"><div class="center"></div></div>
      </div>
      <div class="result" id="result"></div>
    </div>

    <div class="panel">
      <h1>ë©”ë‰´ ì„¤ì •</h1>
      <p>ì½¤ë§ˆ(,) ë˜ëŠ” ì¤„ë°”ê¿ˆìœ¼ë¡œ ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (2ê°œ ì´ìƒ)</p>
      <div class="controls">
        <textarea id="itemsInput">ê¹€ì¹˜ì°Œê°œ, ë¹„ë¹”ë°¥, ëˆê¹ŒìŠ¤, ì§¬ë½•, ì´ˆë°¥, ë‹­ê°ˆë¹„, ë¶ˆê³ ê¸°, íŒŒìŠ¤íƒ€</textarea>
        <div class="row">
          <button class="btn" id="applyBtn">ë©”ë‰´ ì ìš©</button>
          <button class="btn secondary" id="shuffleBtn">ëœë¤ ì„ê¸°</button>
          <span class="pill" id="countPill"></span>
        </div>
        <div class="row">
          <button class="btn" id="spinBtn">ë£°ë › ëŒë¦¬ê¸° ğŸ¯</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ------- Utilities for SVG pie slices
    function polarToCartesian(cx, cy, r, angleDeg){
      const a = (angleDeg - 90) * Math.PI / 180;
      return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };
    }
    function describeArc(cx, cy, r, startAngle, endAngle){
      const start = polarToCartesian(cx, cy, r, endAngle);
      const end   = polarToCartesian(cx, cy, r, startAngle);
      const largeArc = endAngle - startAngle <= 180 ? 0 : 1;
      return [
        `M ${cx} ${cy}`,
        `L ${start.x} ${start.y}`,
        `A ${r} ${r} 0 ${largeArc} 0 ${end.x} ${end.y}`,
        'Z'
      ].join(' ');
    }

    // ------- Wheel state
    const wheelEl = document.getElementById('wheel');
    const resultEl = document.getElementById('result');
    const inputEl = document.getElementById('itemsInput');
    const countPill = document.getElementById('countPill');
    const palette = [
      '#60a5fa','#34d399','#f472b6','#f59e0b','#a78bfa','#f87171','#22d3ee','#84cc16',
      '#fb7185','#38bdf8','#e879f9','#fbbf24','#10b981','#d946ef'
    ];
    let items = [];
    let spinning = false;
    let indicatorRotation = 0; // degrees

    function parseItems(raw){
      return raw
        .split(/\n|,/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    function updateCount(){
      countPill.textContent = `${items.length}ê°œ ë©”ë‰´`;
    }

    function buildWheel(){
      // Clear
      wheelEl.innerHTML = '';

      const size = 600; // SVG viewBox size (px, virtual)
      const r = 280;    // radius
      const cx = size/2, cy = size/2;
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
      svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      svg.style.overflow = 'visible';

      const gWheel = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      gWheel.setAttribute('id', 'wheelGroup');

      const n = items.length;
      const sliceAngle = 360 / n;

      for(let i=0;i<n;i++){
        const start = i * sliceAngle;
        const end = (i+1) * sliceAngle;
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', describeArc(cx, cy, r, start, end));
        path.setAttribute('fill', palette[i % palette.length]);
        path.setAttribute('stroke', 'rgba(255,255,255,0.25)');
        path.setAttribute('stroke-width', '1');
        gWheel.appendChild(path);

        // Label (center of slice)
        const mid = start + sliceAngle/2;
        const labelR = r * 0.62;
        const p = polarToCartesian(cx, cy, labelR, mid);
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', p.x);
        text.setAttribute('y', p.y);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('dominant-baseline', 'middle');
        text.setAttribute('font-weight','700');
        text.setAttribute('fill', '#0b1224');
        text.style.fontSize = Math.max(12, 18 - Math.max(0, items[i].length - 6)) + 'px';
        text.textContent = items[i];
        gWheel.appendChild(text);
      }

      // Outer ring
      const ring = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      ring.setAttribute('cx', cx); ring.setAttribute('cy', cy); ring.setAttribute('r', r+6);
      ring.setAttribute('fill', 'none');
      ring.setAttribute('stroke', 'rgba(255,255,255,0.6)');
      ring.setAttribute('stroke-width', '10');

      // Shadow (soft vignette)
      const shadow = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      shadow.setAttribute('cx', cx); shadow.setAttribute('cy', cy); shadow.setAttribute('r', r+14);
      shadow.setAttribute('fill', 'rgba(0,0,0,0.25)');
      shadow.setAttribute('filter', 'blur(2px)');

      // ----- Indicator group (central needle that rotates)
      const gIndicator = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      gIndicator.setAttribute('id', 'indicatorGroup');

      // Needle: isosceles triangle pointing to 12 o'clock initially
      const tip = { x: cx, y: cy - (r - 12) };
      const baseL = { x: cx - 12, y: cy + 22 };
      const baseR = { x: cx + 12, y: cy + 22 };
      const needle = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      needle.setAttribute('d', `M ${tip.x} ${tip.y} L ${baseL.x} ${baseL.y} L ${baseR.x} ${baseR.y} Z`);
      needle.setAttribute('fill', 'url(#needleGrad)');
      needle.setAttribute('stroke', 'rgba(255,255,255,0.55)');
      needle.setAttribute('stroke-width', '1');
      needle.style.filter = 'drop-shadow(0 4px 10px rgba(0,0,0,0.35))';

      // small cap circle to tidy the base
      const cap = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      cap.setAttribute('cx', cx); cap.setAttribute('cy', cy + 14);
      cap.setAttribute('r', 10);
      cap.setAttribute('fill', 'rgba(0,0,0,0.3)');

      // defs for gradient
      const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
      const lg = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
      lg.setAttribute('id', 'needleGrad');
      lg.setAttribute('x1', '0'); lg.setAttribute('y1', '0'); lg.setAttribute('x2', '0'); lg.setAttribute('y2', '1');
      const s1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#ffffff'); s1.setAttribute('stop-opacity','0.95');
      const s2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#22d3ee');
      lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg);

      svg.appendChild(defs);
      svg.appendChild(shadow);
      svg.appendChild(gWheel);
      svg.appendChild(ring);
      svg.appendChild(gIndicator);

      gIndicator.appendChild(needle);
      gIndicator.appendChild(cap);

      wheelEl.appendChild(svg);

      // Reset rotations
      gsap.set('#indicatorGroup', { rotation: indicatorRotation, transformOrigin:'50% 50%' });
    }

    function spin(){
      if(spinning || items.length < 2) return;
      spinning = true;
      resultEl.textContent = '';

      const n = items.length;
      const slice = 360 / n;
      const chosenIndex = Math.floor(Math.random() * n);

      // Target angle for the indicator (0deg = 12 o'clock)
      const sliceStart = chosenIndex * slice;
      const sliceMid = sliceStart + slice/2;
      const randomOffset = (Math.random() - 0.5) * (slice * 0.7); // avoid borders
      const targetAngle = sliceMid + randomOffset;

      // Normalize current rotation 0..360
      const current = ((indicatorRotation % 360) + 360) % 360;
      let delta = targetAngle - current;
      const extraSpins = 5 + Math.floor(Math.random()*4); // 5..8 spins for drama
      delta += 360 * extraSpins;

      const duration = 5.4 + Math.random()*1.4; // seconds

      gsap.to('#indicatorGroup', {
        rotation: indicatorRotation + delta,
        transformOrigin:'50% 50%',
        ease: 'power4.out',
        duration,
        onComplete(){
          indicatorRotation = indicatorRotation + delta;
          const winner = items[chosenIndex];
          resultEl.textContent = `ì˜¤ëŠ˜ì˜ ë©”ë‰´: ${winner}`;
          pulseCenter();
          spinning = false;
        }
      });
    }

    function pulseCenter(){
      gsap.fromTo('.hub .center', { scale:1 }, { scale:1.08, repeat:1, yoyo:true, duration:0.18, ease:'power1.inOut' });
    }

    function shuffle(){
      for(let i=items.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [items[i], items[j]] = [items[j], items[i]];
      }
      indicatorRotation = 0;
      buildWheel();
      resultEl.textContent = '';
    }

    // ------- Bindings
    document.getElementById('applyBtn').addEventListener('click', () => {
      const parsed = parseItems(inputEl.value);
      if(parsed.length < 2){
        alert('ë©”ë‰´ë¥¼ 2ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      items = parsed;
      indicatorRotation = 0;
      buildWheel();
      updateCount();
    });

    document.getElementById('shuffleBtn').addEventListener('click', () => {
      if(items.length < 2) return; shuffle(); updateCount();
    });

    document.getElementById('spinBtn').addEventListener('click', () => {
      spin();
      // prevent rapid re-clicks until end
      const btn = document.getElementById('spinBtn');
      btn.disabled = true; btn.style.filter='grayscale(0.3)';
      setTimeout(() => { btn.disabled = false; btn.style.filter=''; }, 7000);
    });

    // ------- Init with defaults
    items = parseItems(inputEl.value);
    buildWheel();
    updateCount();
  </script>
</body>
</html>
